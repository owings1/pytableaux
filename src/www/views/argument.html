{% extends 'layout.html' %}
{% import 'helper.html' as helper %}
{% block content %}
    <script type="text/template" id="premiseTemplate">
        {{ helper.premise('{n}') }}
    </script>
    {% if errors %}
        <div class="errors">
            <h3>Please correct the following errors:</h3>
            <dl>
                {% for field in errors %}
                    <dt>{{ field }}:</dt>
                    <dd>{{ errors[field].message|e }}</dd>
                {% endfor %}
            </dl>
            <div class="clear"></div>
        </div>
    {% endif %}
    <form class="argument" action="/" method="post">
        <fieldset class="options">
            <legend>Options</legend>
            <div class="input select">
                <label for="notation">Notation</label>
                <select id="notation" name="notation">
                    {% for module in notation_modules %}
                        <option value="{{ module }}" {{ helper.select_opt(form_data, 'notation', module) }}>
                            {{ notations[module].name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="input select">
                <label for="logic">Logic</label>
                <select id="logic" name="logic" multiple="multiple">
                    {% for module in logic_modules %}
                        <option value="{{ module }}" {{ helper.select_opt_multi(form_data, 'logic', module) }}>
                            {{ logics[module].name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="input select">
                <label for="writer">Output</label>
                <select id="writer" name="writer">
                    {% for module in writer_modules %}
                        <option value="{{ module }}" {{ helper.select_opt(form_data, 'writer', module) }}>
                            {{ writers[module].name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </fieldset>
        <fieldset class="lexicon">
            <legend>Lexicon</legend>
            <div class="lexicons">
                {% for module in notation_modules %}
                    <div class="lexicon hidden" id="Lexicon_{{ module }}">
                        <span class="label">Atomic Symbols</span>
                        <ul class="atomic-symbols">
                            {% for char in notations[module].Parser.achars %}
                                <li>{{ char|e }}</li>
                            {% endfor %}
                        </ul>
                        <span class="label">Operator Symbols</span>
                        <dl class="operator-symbols">
                            {% for operator in operators_list %}
                            {% set ochars = notations[module].Parser.ochars %}
                                <dt>{{ ochars.keys()[ochars.values().index(operator)]|e }}</dt>
                                <dd>{{ operator|e }}</dd>
                            {% endfor %}
                        </dl>
                        <div class="clear"></div>
                    </div>
                {% endfor %}
        </fieldset>
        <fieldset class="predicates">
            <legend>Predicates</legend>
            <div class="predicates">
                <table>
                    <thead>
                        <tr>
                            <th>Symbol</th>
                            <th>Name</th>
                            <th>Arity</th>
                        </th>
                    </thead>
                    <tbody>
                        {% for name in predicates_list %}
                            {% set predicate = predicates[name] %}
                            <tr>
                                <td>
                                    {% for module in notation_modules %}
                                        {% if predicate.index == None and predicate.subscript == None %}
                                            {% set idx = notations[module].Parser.pnames[name] %}
                                        {% else %}
                                            {% set idx = [notations[module].Parser.pchars[predicate.index], predicate.subscript] %}
                                        {% endif %}
                                        <span class="operator notation-{{module}}">
                                            {{ idx[0]|e }}{% if idx[1] > 0 %}<span class="subscript">{{ idx[1] }}</span>{% endif %}
                                        </span>
                                    {% endfor %}
                                </td>
                                <td>{{ name|e }}</td>
                                <td>{{ predicate.arity }}</td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </fieldset>
        <fieldset class="argument">
            <legend>Argument</legend>
            <div class="premises">
                {% if 'premises[]' in form_data %}
                    {% for premise in form_data['premises[]'] %}
                        {% set error_label = 'Premise ' ~ loop.index %}
                        {% if error_label in errors %}
                            {{ helper.premise(loop.index, premise, 'bad', errors[error_label].message) }}
                        {% else %}
                            {{ helper.premise(loop.index, premise, 'good') }}
                        {% endif %}
                    {% endfor %}
                {% endif %}
            </div>
            <div class="sentence input conclusion">
                <label for="conclusion">Conclusion</label>
                <input id="conclusion" class="sentence conclusion" type="text" name="conclusion" value="{{ form_data['conclusion'] }}" />
                {% set status = '' %}
                {% set message = '' %}
                {% if 'Conclusion' in errors %}
                    {% set status = 'bad' %}
                    {% set message = errors['Conclusion'].message %}
                {% elif 'conclusion' in form_data %}
                    {% set status = 'good' %}
                {% endif %}
                <span class="status {{ status }}" title="{{ message|e }}"></span>
            </div>    
            <div class="input submit">
                <input type="submit" value="Go"/>
            </div>
        </fieldset>
    </form>
    <div class="clear"></div>
{% endblock %}